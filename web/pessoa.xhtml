<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
<!--    xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html">-->

    <h:head>
        <title>Controle de Pessoas</title>
        <link type="text/css" rel="stylesheet" href="/css/estilos.css" />
    </h:head>
    <h:body>
        <p align="right">Usuário:<b>#{cntrUsuario.usuario}</b></p>
        
        <h:form id="formulario">
            <p:panel header="Incluir Pessoas">
                <h:panelGrid columns="3" id="grid" width="100%" border="1" styleClass="comBordaSimples" columnClasses="texto,form,messages">
                    <h:outputText value="Nome " />
                    <p:inputText id="nome" value="#{cntrPessoa.pessoa.nome}" size="50" required="true" requiredMessage="Nome Obrigatório"/>
                    <p:message for="nome"/>
                    <h:outputText value="Endereço" />
                    <p:inputText id="endereco" value="#{cntrPessoa.pessoa.endereco}" size="50" required="true" requiredMessage="Endereço Obrigatório"/>
                    <p:message for="endereco"/>
                    <h:outputText value="Número" />
                    <p:inputNumber id="numeroResidencia" converter="javax.faces.Integer" decimalPlaces="0" value="#{cntrPessoa.pessoa.numeroresidencia}" size="4" maxlength="5" required="true" requiredMessage="Número Obrigatório">
                    </p:inputNumber>
                    <p:message for="numeroResidencia"/>
                    <h:outputText value="CEP" />
                    <p:inputMask id="cep" value="#{cntrPessoa.pessoa.cep}" size="10" mask="99.999-999" required="true" requiredMessage="CEP Obrigatório"/>
                    <p:message for="cep"/>
                    <h:outputText value="Estado" /> 
                    <p:selectOneMenu id="comboEstados" value="#{cntrPessoa.pessoa.estado}" required="true" requiredMessage="UF é Obrigatória">  
                        <f:selectItem itemLabel="Selecione" itemValue="" noSelectionOption="true" />
                        <f:selectItems value="#{cntrPessoa.listestados}" var="estados" itemLabel="#{estados.nomeestado}" itemValue="#{estados.idunidFed}" />
                        <p:ajax 
                            listener="#{cntrPessoa.comboEstadoChange}"
                            event="change"  
                            update="comboCidade"  
                            process="comboEstados" />  
                    </p:selectOneMenu>
                    <p:message for="comboEstados" />
                    <h:outputText value="Cidade" />
                    <p:selectOneMenu id="comboCidade" value="#{cntrPessoa.pessoa.cidade}" required="true" requiredMessage="Cidade é Obrigatória">  
                        <f:selectItem itemLabel="Selecione" itemValue="" />  
                        <f:selectItems value="#{cntrPessoa.listacidade}" var="cidades" itemLabel="#{cidades.nomedesc}" itemValue="#{cidades.nomedesc}" />
                    </p:selectOneMenu>
                    <p:message for="comboCidade" />
                    <h:outputText value="Telefone" />
                    <p:inputMask id="telefone" value="#{cntrPessoa.pessoa.telefone}" mask="(99)9999-9999" size="15" required="true" requiredMessage="Telefone Obrigatório"/>
                    <p:message for="telefone"/>
                    <h:outputText value="Celular" />
                    <p:inputMask id="celular" value="#{cntrPessoa.pessoa.celular}"  mask="(99)99999-9999" size="15" required="true" requiredMessage="Celular Obrigatório"/>
                    <p:message for="celular"/>
                    <h:outputText value="Bairro" />
                    <p:inputText id="bairro" value="#{cntrPessoa.pessoa.bairro}" size="40" required="true" requiredMessage="Bairro Obrigatório"/>
                    <p:message for="bairro"/>
                    <h:outputText value="Data Nascimento" />
                    <p:calendar id="dataNascimento" value="#{cntrPessoa.pessoa.datanascimento}" pattern="dd/MM/yyyy" size="10" required="true" requiredMessage="Data Nascimento Obrigatória"/>
                    <p:message for="dataNascimento"/>
                    <h:outputText value="Email" />
                    <p:inputText id="email" value="#{cntrPessoa.pessoa.email}" size="40" required="true" label="Email" requiredMessage="E-mail Obrigatório">
                        <f:validateRegex pattern="[\w\.-]*[a-zA-Z0-9_]@[\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]" />
                        <f:attribute name="cpf" value="" />
                        <f:validator validatorId="emailValidator"/>
                    </p:inputText>
                    <p:message for="email" />
                    <h:outputText value="CPF" />
                    <p:inputMask id="cpf" value="#{cntrPessoa.pessoa.cpf}" converter="cpfConverter" mask="999.999.999-99" size="14" required="true" requiredMessage="CPF Obrigatório">
                        <f:attribute name="cpf" value="" />
                        <f:validator validatorId="cpfValidator"/>
                    </p:inputMask> 
                    <p:message for="cpf" /> 
                    <p:outputLabel id="sexo" for="sexo" value="Sexo:" />
                    <p:selectOneRadio id="console" value="#{cntrPessoa.pessoa.sexo}" required="true" requiredMessage="Gênero é Obrigatório">
                        <f:selectItem itemLabel="Masculino" itemValue="M" />
                        <f:selectItem itemLabel="Feminino" itemValue="F" />
                    </p:selectOneRadio>
                    <p:message for="sexo"/> 
                    <h:outputText value="Apelido" />
                    <p:inputText id="apelido" value="#{cntrPessoa.pessoa.apelido}" size="20" required="true" requiredMessage="Apelido é Obrigatório">
                        <f:attribute name="cpf" value="" />
                        <f:validator validatorId="apelidoValidator"/>
                    </p:inputText>
                    <p:message id="mensagem-apelido" for="apelido" />
                    
                    <h:outputText value="Senha" />                    
                    <p:password id="senha" size="25" value="#{cntrPessoa.pessoa.senha}" match="senhac" required="true" requiredMessage="Senha é Obrigatória" validatorMessage="Senhas não conferem">
                    </p:password>
                    <p:message for="senha" />
                    <h:outputText value="Confirme a Senha" />                    
                    <p:password id="senhac" size="25" value="#{cntrPessoa.pessoa.senha}" required="true" requiredMessage="Confirmação de Senha Obrigatória" >
                    </p:password>
                    <p:message for="senhac" />
                    <p:commandButton value="Gravar" action="#{cntrPessoa.addpessoa()}" update=":formtable:tabelaPessoa,grid">
                    </p:commandButton>
                    <p:commandButton value="Limpar" type="reset"/>
                </h:panelGrid>
            </p:panel>
        </h:form>
        
        <h:form id="formtable">
            <p:dataTable style="width:100%" id="tabelaPessoa" value="#{cntrPessoa.listarPessoa}" emptyMessage="Não há Registros" var="pes" paginator="true" rows="20" rowsPerPageTemplate="10,25,35,50">>
                <f:facet name="header">
                    Lista de Pessoas Cadastrados
                </f:facet>
                <p:column headerText="Nome" width="35%" filterMaxLength="40" sortBy="#{pes.nome}" filterBy="#{pes.nome}" filterStyle="max-width: 400px; min-width:400px;">
                    <h:outputText value="#{pes.nome}"/>
                </p:column>
                <p:column headerText="Email" width="20%" filterMaxLength="20" sortBy="#{pes.email}" filterBy="#{pes.email}" filterStyle="max-width: 250px; min-width:250px;">
                    <h:outputText value="#{pes.email}"/>
                </p:column>
                <p:column headerText="Apelido" filterMaxLength="20" sortBy="#{pes.apelido}" filterBy="#{pes.apelido}" filterStyle="max-width: 150px; min-width:150px;">
                    <h:outputText value="#{pes.apelido}"/>
                </p:column>
                <p:column headerText="CPF" filterMaxLength="15" sortBy="#{pes.cpf}" filterBy="#{pes.cpf}" filterStyle="max-width: 150px; min-width:150px;">
                    <h:outputText value="#{pes.maskCpf}" id="cpf">
                    </h:outputText>
                </p:column>
                <p:column width="8%">
                    <p:commandButton action="#{cntrPessoa.excluirPessoa(pes)}" icon="ui-icon-closethick"  update="tabelaPessoa" />
                    <p:commandButton action="#{cntrPessoa.prepararalterarPessoa(pes)}" icon="ui-icon-pencil" update=":formdialog:display" oncomplete="PF('pessoaDialog').show()">
                    </p:commandButton>
                </p:column>
                <f:facet name="footer">
                    <h:outputText value="Existem " />
                    <h:outputText value="#{cntrPessoa.qtdpessoas}" />
                    <h:outputText value=" Pessoas cadastrados. " />
                </f:facet>
            </p:dataTable> 
        </h:form>
        
        <h:form id="formdialog" >
            <p:dialog header="Detalhes do Participante" widgetVar="pessoaDialog" id="pessoaDlg" resizable="true" modal="true">
                <p:messages id="a-msgs" closable="true" />
                <h:panelGrid id="display" columns="2">
                    <h:outputText value="Nome" />
                    <p:inputText value="#{cntrPessoa.pessoa1.nome}" style="font-weight:bold"/>
                    <h:outputText value="Endereço" />
                    <p:inputText value="#{cntrPessoa.pessoa1.endereco}" style="font-weight:bold"/>
                    <h:outputText value="Número" />
                    <p:inputNumber id="numeroResidencia" converter="javax.faces.Integer" decimalPlaces="0" value="#{cntrPessoa.pessoa1.numeroresidencia}" size="4" maxlength="5" >
                    </p:inputNumber>
                    <h:outputText value="CEP" />
                    <p:inputMask id="cep" value="#{cntrPessoa.pessoa1.cep}" size="10" mask="99.999-999" />
                    <h:outputText value="Estado" />
                    <p:selectOneMenu id="comboEstadosDialog" value="#{cntrPessoa.pessoa1.estado}" >  
                       <f:selectItems itemLabel="#{cntrPessoa.nomeestado}" itemValue=""  />
                       <f:selectItems value="#{cntrPessoa.listestados}"  var="estado" itemLabel="#{estado.nomeestado}" itemValue="#{estado.idunidFed}" />                    
                        <p:ajax 
                            listener="#{cntrPessoa.comboEstadoChangeDialog1()}"
                            event="change"  
                            update="comboCidadeDialog"  
                            process="comboEstadosDialog" 
                        />  
                    </p:selectOneMenu>
                    <h:outputText value="Cidade" />
                    <p:selectOneMenu id="comboCidadeDialog" value="#{cntrPessoa.pessoa1.cidade}">  
                        <f:selectItems itemLabel="#{cntrPessoa.pessoa1.cidade}" itemValue="" />  
                        <f:selectItems value="#{cntrPessoa.listacidade}" var="cidades" itemLabel="#{cidades.nomedesc}" itemValue="#{cidades.nomedesc}" />
                    </p:selectOneMenu>                       
                    <h:outputText value="Telefone" />
                    <p:inputText value="#{cntrPessoa.pessoa1.telefone}" style="font-weight:bold"/>
                    <h:outputText value="Celular" />
                    <p:inputMask id="celular" value="#{cntrPessoa.pessoa1.celular}"  mask="(99)99999-9999" size="15" />
                    <h:outputText value="Bairro" />
                    <p:inputText value="#{cntrPessoa.pessoa1.bairro}" style="font-weight:bold" />
                    <h:outputText value="Data Nasc" />
                    <p:calendar value="#{cntrPessoa.pessoa1.datanascimento}" style="font-weight:bold" pattern="dd/MM/yyyy">
                    </p:calendar>
                    <h:outputText value="E-mail" />
                    <p:inputText value="#{cntrPessoa.pessoa1.email}" style="font-weight:bold" >
                        <f:attribute name="cpf" value="#{cntrPessoa.pessoa1.cpf}" />
                        <f:validator validatorId="emailValidator" />
                    </p:inputText>
                    <p:outputLabel id="sexo" for="sexo" value="Sexo:" />
                    <p:selectOneRadio id="console" value="#{cntrPessoa.pessoa1.sexo}" >
                        <f:selectItem itemLabel="Masculino" itemValue="M" />
                        <f:selectItem itemLabel="Feminino" itemValue="F" />
                    </p:selectOneRadio>
                    <h:outputText value="Apelido" />
                    <p:inputText value="#{cntrPessoa.pessoa1.apelido}" size="20" >
                        <f:attribute name="cpf" value="#{cntrPessoa.pessoa1.cpf}" />
                        <f:validator validatorId="apelidoValidator" />
                    </p:inputText>
                    <p:commandButton value="Alterar" icon="ui-icon-check" action="#{cntrPessoa.alterarPessoa()}" 
                                     update=":formdialog:a-msgs,:formtable:tabelaPessoa">
                    </p:commandButton>
                    <p:commandButton value="Cancelar" update=":formdialog:pessoaDlg" process="@this">
                                     <p:resetInput target=":formdialog:pessoaDlg" />
                    </p:commandButton>
                </h:panelGrid>
            </p:dialog>
        </h:form>
    </h:body>
</html>

